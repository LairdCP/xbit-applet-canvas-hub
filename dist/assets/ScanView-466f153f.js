import{_ as h,d as u,o as n,c as o,a as i,b as a,F as r,r as S,n as d,u as g,x as c,e as l,t as v}from"./index-2b0b4acd.js";const f=u({name:"ScanView",setup(){return{devicesStore:g(),xbit:c}},async beforeRouteLeave(){if(this.devicesStore.connecting)try{await this.devicesStore.disconnectDevice()}catch{}return await this.devicesStore.stopScanning()===null},async mounted(){this.devicesStore.clear();try{await this.devicesStore.disconnectDevice()}catch{}await this.devicesStore.startScanning()},methods:{async selectDevice(e){this.devicesStore.selectDevice(e)},async connectDevice(e){if(c.sendToast({message:"Connecting...",options:{autoClose:!1}}),this.devicesStore.connected)try{await this.devicesStore.disconnectDevice()}catch(s){console.error(s),this.devicesStore.selected=null,c.sendToast({message:(error==null?void 0:error.message)||error||"Unable to disconnect",type:"error"})}this.devicesStore.scanningTimeout&&await this.devicesStore.stopScanning(),this.$watch("devicesStore.connected",async s=>{s&&(c.sendClearToast(),this.$router.push({name:"home"}))});try{await this.devicesStore.connectDevice(e)}catch(s){console.log(s),this.devicesStore.selected=null,c.sendToast({message:(s==null?void 0:s.message)||s||"Unable to connect",type:"error"}),console.error(s)}}}}),m={key:0,class:"pl-4 p-2 mb-2 text-white btn-gradient-1"},p=a("i",{class:"fa-solid fa-arrows-rotate"},null,-1),y={key:1,class:"pl-4 p-2 mb-2 text-white btn-gradient-1"},b={class:"flex flex-col",style:{flex:"1 1 auto","overflow-y":"auto","overflow-x":"hidden"}},w=["onClick"],D={key:0},C={key:1,class:"fas fa-check"},k={class:"action-button btn-gradient-1",style:{"justify-self":"flex-end"}},_=["disabled"];function $(e,s,T,B,V,x){return n(),o(r,null,[e.devicesStore.sortedDevices.length===0&&!e.devicesStore.scanningTimeout?(n(),o("h3",m,[i("Scan for BLE Devices "),p])):(n(),o("h3",y,"Select Device")),a("div",b,[(n(!0),o(r,null,S(e.devicesStore.sortedDevices,t=>(n(),o("div",{key:t.address,class:d(["bg-canvas-slate-500 ml-4 p-2 mb-2 rounded text-white text-center cursor-pointer hover:bg-canvas-slate-600 max-w-sm",{"bg-canvas-sky-500":t.address===e.devicesStore.connected,"bg-canvas-slate-600":t.address===e.devicesStore.selected,"opacity-25":!t.isCanvas}]),onClick:L=>e.selectDevice(t)},[t.isCanvas?(n(),o("span",D,"Canvas ")):l("",!0),i("Device "+v(e.xbit.formatAddress(t.address))+", "+v(t.rssi)+" dBm ",1),t.address===e.devicesStore.selected?(n(),o("i",C)):l("",!0)],10,w))),128))]),a("div",k,[a("button",{onClick:s[0]||(s[0]=t=>e.connectDevice(e.devicesStore.selected)),class:d(["bg-canvas-slate-800 p-4 w-full h-full",{"text-white cursor-pointer":e.devicesStore.selected&&!e.devicesStore.connecting,"text-gray-600 cursor-not-allowed":!e.devicesStore.selected||e.devicesStore.connecting}]),disabled:!e.devicesStore.selected||e.devicesStore.connecting}," Continue ",10,_)])],64)}const E=h(f,[["render",$]]);export{E as default};
